<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: tips | 飲んだり寝たり]]></title>
  <link href="http://nomnel.net/blog/categories/tips/atom.xml" rel="self"/>
  <link href="http://nomnel.net/"/>
  <updated>2013-07-24T23:35:25+09:00</updated>
  <id>http://nomnel.net/</id>
  <author>
    <name><![CDATA[nomnel]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Railsで複数テーブルに跨ってincludesする]]></title>
    <link href="http://nomnel.net/blog/rails-multi-table-includes/"/>
    <updated>2013-07-20T23:00:00+09:00</updated>
    <id>http://nomnel.net/blog/rails-multi-table-includes</id>
    <content type="html"><![CDATA[<p>例えば<code>A has_many Bs</code>かつ<code>B has_one C</code>であるとき</p>

<p><code>ruby
A.all.includes(bs: :c)
</code></p>

<p>とすればよい. さらに<code>B has_many Ds</code>であれば</p>

<p><code>ruby
A.all.includes(bs: [:c, :ds])
</code></p>

<p>となる.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rubyでeachのブロックに複数の値を渡す]]></title>
    <link href="http://nomnel.net/blog/ruby-multi-values-to-each-block/"/>
    <updated>2013-07-20T13:30:00+09:00</updated>
    <id>http://nomnel.net/blog/ruby-multi-values-to-each-block</id>
    <content type="html"><![CDATA[<p>配列で渡す.</p>

<p>```ruby
[[1, 2], [3, 4]].each{|a, b| puts b}</p>

<h1>2</h1>

<h1>4</h1>

<h1>ちなみに</h1>

<p>[[1, 2], [3, 4]].each{|a| puts a[1]}</p>

<h1>2</h1>

<h1>4</h1>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Paperclipのsytlesやconvert_optionsの変更を既存のデータにも適用する]]></title>
    <link href="http://nomnel.net/blog/paperclip-refresh-missing-styles/"/>
    <updated>2013-07-18T11:35:00+09:00</updated>
    <id>http://nomnel.net/blog/paperclip-refresh-missing-styles</id>
    <content type="html"><![CDATA[<p>例えば<a href="http://nomnel.net/blog/fjord-day35/">後付で投稿画像を640px x 640pxに統一するようにした</a>ときなど. 既存のデータにもその変更を反映したいときは</p>

<p><code>sh
rake paperclip:refresh:missing_styles
</code></p>

<p>とすればPaperclipで管理している全てのデータ(original以外)を現在のルールで再生成してくれる. ただこれだと変更に関係ないクラスも(ex: BookCoverだけ変更したのにUserImageも)再生成されるので非効率. なので</p>

<p>```ruby
BookCover.all.each do |cover|
  cover.image.reprocess!(*nil)
  if cover.errors.present?</p>

<pre><code># エラー処理
</code></pre>

<p>  end
```</p>

<p>のようにすれば特定のクラスのデータだけ再生成できる.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails4でObserverを使う]]></title>
    <link href="http://nomnel.net/blog/rails4-observer/"/>
    <updated>2013-07-14T16:45:00+09:00</updated>
    <id>http://nomnel.net/blog/rails4-observer</id>
    <content type="html"><![CDATA[<p>Rails4ではobserversが削除されているので, 使用したい場合は<code>rails-observer</code>gemをインストールする.</p>

<p><code>ruby
gem 'rails-observers'
</code></p>

<p>callbackで</p>

<p>```ruby
class Hoge &lt; ActiveRecord::Base
  before_save do</p>

<pre><code># 何か処理
</code></pre>

<p>  end
end
```</p>

<p>や</p>

<p>```ruby
class Hoge &lt; ActiveRecord::Base
  before_save :some_action</p>

<p>  def some_action</p>

<pre><code># 何か処理
</code></pre>

<p>  end
end
```</p>

<p>のようにしてもよい.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Active Recordで属性にアクセスするメソッドを上書きする]]></title>
    <link href="http://nomnel.net/blog/acticerecord-redefine-attr-access-method/"/>
    <updated>2013-06-18T22:00:00+09:00</updated>
    <id>http://nomnel.net/blog/acticerecord-redefine-attr-access-method</id>
    <content type="html"><![CDATA[<p>RailsでUserモデルがあってそれがnameという属性を持っているとする. このとき例えば, User#nameの値を条件fooによって変えたいとき,<!-- more --></p>

<p>```ruby
class User &lt; ActiveRecord::Base
  def name</p>

<pre><code>foo ? self[:name] : 'some special value'
</code></pre>

<p>  end
end
```</p>

<p>のようにnameメソッドを<a href="#caution">上書き</a>してやればよい.</p>

<p>ちなみに<code>self[:name]</code>の<code>[]</code>は<code>read_attribute</code>のaliasで, 別に<code>write_attribute</code>もあるらしい(<a href="http://blog.eiel.info/blog/2012/12/17/read-attribute-activerecord/">参考</a>).</p>

<p><a name="caution">※</a> 上書きというよりは先に定義していると言った方が正確だと思う. というのもaround aliasを使って</p>

<p>```ruby
class User &lt; ActiveRecord::Base
  alias :org_name :name
  def name</p>

<pre><code>foo ? org_name : 'some special value'
</code></pre>

<p>  end
end
```</p>

<p>のように定義しようとすると<code>ねーむってなぁに？</code>って怒られるからだ. 多分(確認すればいいのだけど), <code>method_missing</code>で処理してるんだと思う.</p>
]]></content>
  </entry>
  
</feed>
